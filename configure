#!/bin/bash

# TODO should the cmake builds be in release mode?

[ ! -d dep ] && echo "configure must be run from base uinta directory" && return
cd dep

git submodule update --init --recursive

### GLFW
[ ! -d glfw ] && >&2 echo "dep/glfw missing" && return
mkdir glfw/build 2> /dev/null
cmake -B glfw/build -S glfw
make --directory glfw/build -j 32


### GLAD
if ! command -v glad &> /dev/null
then
	echo "`glad` command not found. Please install glad and ensure it's in the path"
	return
fi
glad --profile core --out-path glad/build --api gles2=3.2 --spec gl --generator c


### Assimp has a unique build, so we follow their script then reset the git state:
#[ ! -d log4cplus ] && >&2 echo "dep/log4cplus missing" && return
#cd log4cplus
#git submodule update --init --recursive
#./configure
#make -j 32
## log4cplus creates a bunch of files while building...
## this will remove the files, and clear the git submodule dirty state
#git add . && git reset --hard
#cd ..

cd ..

echo "Configuration successfully completed."
